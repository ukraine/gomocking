function attachHandlers(){attachModalHandlers(),attachDropdownHandlers(),billingStuff()}function billingStuff(){$("a.show-invoice").on("click",function(event){event.preventDefault(),$elem=$(event.currentTarget),invoice_id=$elem.data("invoice");var url="/billing/invoices/"+invoice_id+"/";$("#show-invoice").modal({remote:url,show:!0,backdrop:!0})})}function setLoading($button){$button.attr("disabled","disabled")}function handleError(){$(".submit-button").removeAttr("disabled"),$(".btn").button("reset"),console.log("hello"),$(".stripe-form.active").removeClass("active")}function clearAllErrors(){$("ul.errorlist").remove(),$(".stripeError").empty()}function stripeResponseHandler(status,response){if(response.error)$(".stripe-form.active .stripeError").html(response.error.message),handleError();else{var form$=$(".stripe-form.active"),token=response.id;form$.append("<input type='hidden' name='stripeToken' value='"+token+"' />"),form$.submit()}}function showMenu(button){var menu=$(button.data("menu-id")),pos=button.offset(),buttonWidth=button.outerWidth(),eHeight=button.outerHeight(),top=pos.top+eHeight/2-18+"px",leftMargin=10,left=pos.left+buttonWidth+leftMargin+"px";menu.css({position:"absolute",zIndex:5e3,left:left,top:top}),menu.fadeIn(),$("ul.dropdown-menu").click(function(e){console.log("dropdown menu click"),e.stopPropagation()}),$(document).click(function(){console.log("anywhere click"),hideMenus()})}function hideMenus(){$(".dropdown-menu").hide(),$("document").unbind("click")}function attachDropdownHandlers(){$("a[data-dropdown-button]").on("click",function(e){e.preventDefault(),e.stopPropagation(),showMenu($(this))})}function attachModalHandlers(){$(".modal").on("shown",function(e){$("input:visible:first",$(this)).focus()}),$("form").on("submit",function(e){$(this).find("[type=submit]").attr("disabled","disabled");var $form=$(this),$button=$form.find("button");if(setLoading($button),clearAllErrors(),$(this).hasClass("stripe-form")&&($(this).addClass("active"),!$("[name=stripeToken]").val()))return Stripe.createToken({number:$(".card-number",$(this)).val(),cvc:$(".card-cvc",$(this)).val(),exp_month:$(".card-expiry-month",$(this)).val(),exp_year:$(".card-expiry-year",$(this)).val()},stripeResponseHandler),e.preventDefault(),!1;if($form.parents(".modal").length>0){var url=$form.attr("action"),postData=$form.serializeArray();return $.post(url,postData,function(data){var $modal=$form.parents("div.modal-body");if(data.content){var resultModalBody=$(".modal-body",data.content);$modal.html(resultModalBody.html()),$button.button("reset"),attachHandlers()}else window.location.replace(data.redirect)}).fail(function(){$form.prepend("<ul class='errorlist'><li>Sorry, something unexpected went wrong.</li></ul>"),handleError()}),e.preventDefault(),!1}})}$(document).ajaxSend(function(event,xhr,settings){function getCookie(name){var cookieValue=null;if(document.cookie&&""!=document.cookie)for(var cookies=document.cookie.split(";"),i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==name+"="){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break}}return cookieValue}function sameOrigin(url){var host=document.location.host,protocol=document.location.protocol,sr_origin="//"+host,origin=protocol+sr_origin;return url==origin||url.slice(0,origin.length+1)==origin+"/"||url==sr_origin||url.slice(0,sr_origin.length+1)==sr_origin+"/"||!/^(\/\/|http:|https:).*/.test(url)}function safeMethod(method){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(method)}!safeMethod(settings.type)&&sameOrigin(settings.url)&&xhr.setRequestHeader("X-CSRFToken",getCookie("csrftoken"))}),$(document).ready(function(){attachHandlers()});